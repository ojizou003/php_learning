# 「WordPressで学ぶPHP ③関数編」 藤本壱

2023/08/29~08/30

## 関数の基本

- 関数とは、入力された値に対して何らかの処理をし、必要に応じて結果を値で返すもの
- 引数と戻り値
- 関数名(引数1,引数2,...,引数n)
- 組み込み関数とユーザー定義関数

## 日付／時刻を処理する関数

- time() ..現在の時刻を返す(UNIXタイムスタンプ形式)
- getdate() ..UNIXタイムスタンプ形式を年,月,日,曜日,時,分,秒に分解して連想配列で返す
- date(書式指定文字列[,UNIXタイムスタンプ])
- ``` echo date("Y/m/d h:i:s A"); ```
- mktime() ..時,分,秒,月,日,年を引数にUNIXタイムスタンプを返す

## 数学関数

- ceil() ..切り上げ
- floor() ..切り下げ
- intval() ..小数点以下切り捨て
- round(値[,桁]) ..四捨五入
- abs() ..絶対値を求める
- min()/max() ..最小値、最大値を求める
- rand(下限,上限) ..乱数を求める

## 変数関係の関数

- isset() ..変数が存在するかどうかを調べる
- empty() ..変数が空であるかどうかを調べる
- is_型() ..その型であるかどうかを調べる
- unset() ..変数をメモリから削除

## 文字列を処理する関数

- strlen() ..文字列の長さを調べる(バイト数単位)
  - mb_strlen() ..文字列の長さを調べる(漢字やひらがななどを文字単位で)
- 文字列[位置] ..文字列から1文字だけ取り出す(バイト単位)
- substr(文字列,開始位置[,長さまたは終了位置])(バイト単位)
  - mb_substr() ..日本語の文字列を操作するとき
- strtoupper(文字列) ..文字列中のアルファベットをすべて大文字
- strtolower(文字列) ..文字列中のアルファベットをすべて小文字
- ltrim ..先頭からホワイトスペースを削除
- rtrimまたはchop ..末尾からホワイトスペースを削除
- trim ..先頭/末尾両方からホワイトスペースを削除
  - ホワイトスペースとは、スペース、改行文字(\n)、キャリッジリターン(\r)、タブ(\t)の総称
- sprintf(書式指定文字列,値1[,値2...])
  - %b ..2進数で表示
  - %c ..値をASCIIコードとみなし、それに対応する文字を表示
  - %d ..値を整数で表示
  - %u ..値を符号なし整数で表示
  - %f ..値を浮動小数点数で表示
  - %o ..値を8進数で表示
  - %s ..値を文字列で表示
  - %x ..値を16進数の小文字で表示
  - %X ..値を16進数の大文字で表示
  - echo sprintf(); == printf();
- strpos(検索される文字列,検索する文字列) ..検索する文字の位置を返す(先頭0のバイト単位)
- htmlspecialchars() ..HTMLやJavaScript、PHPを無効化
- strip_tags() ..文字列の中からHTMLのタグを取り除く

## 日本語対応の文字列関数

- mb_convert_encording(文字列,変換後の文字コード体系[,変換前の文字コード体系])
- mb_convert_kana(文字列[,オプション,文字コード])

## 正規表現を使った検索と置換

- preg_match('/パターン文字列/',検索対象の文字列) ..見つかったら1,見つからなかったら0
- *,+,?,[],{},(),.,^,\,$,|,/ ..特殊文字
- . ..任意の１文字
- [ ],[ - ] ..範囲指定

- 文字群
  - \d ..数字
  - \D ..数字以外
  - \s ..ホワイトスペース(スペース、改行、タブ)
  - \S ..ホワイトスペース以外
  - \w ..単語構成文字(アルファベット、数字、アンダースコア)
  - \W ..単語構成文字以外

- * ..直前の文字が0回以上出てくる
- + ..直前の文字が1回以上出てくる
- ? ..直前の文字が0回か1回出てくる
- {x} ..直前の文字がx回繰り返す
- {x,} ..直前の文字がx回以上繰り返す
- {x,y} ..直前の文字がx回以上y回以下繰り返す
- () ..直前の文字列をまとめる
- ( | ) ..どれか1つの文字列が含まれるかどうかを検索する
- ^ ..文字列の先頭にそのパターンが含まれるかどうか検索する
- $ ..文字列の末尾にそのパターンが含まれるかどうか検索する
- '/ /i' ..大文字/小文字を区別せずに検索する

- preg_match_all(パターン文字列,検索対象の文字列,結果を受け取る配列変数)
- () ..サブパターンの指定(キャプチャ)
- (?: ) ..キャプチャしない

- +,* ..通常は最長一致
- +?,*? ..最短一致

- preg_replace(パターン文字列,置換する文字列,検索対象の文字列)
- preg_split(パターン文字列,分割対象の文字列[,要素数の上限])
  - list関数と組み合わせると分割後の個々の文字列を別々の変数に代入できる

## ファイル処理に関する関数

- file_get_contents('ファイルのパス') ..読み込んだファイルを1つの変数に代入
- file('ファイルのパス') ..読み込んだファイルを改行で区切った配列が返される
- file_put_contents('ファイルのパス',書き込む内容) ..ファイルにデータ等を書き込む
- fopen('ファイルのパス',モード) ..ファイルを開く
  - モードを指定する文字列
    - r  ..読み込み  先頭  内容保持
    - r+ ..読み書き  先頭  内容保持
    - w  ..書き込み  先頭  内容消去
    - W+ ..読み書き  先頭  内容消去
    - a  ..書き込み  末尾  内容保持
    - a+ ..読み書き  末尾  内容保持
    - x  ..書き込み  先頭  エラー発生
    - x+ ..読み書き  先頭  エラー発生
    - c  ..書き込み  先頭  内容保持
    - c+ ..読み書き  先頭  内容保持
- fgets(ファイルポインタリソース[,読み込むバイト数]) ..テキストファイルからデータを1行ずつ読み込む
- feof(ファイルポインタリソース) ..ファイルを最後まで読み込んでいればtrue、そうでない場合はfalse
- fread(ファイルポインタリソース,読み込むバイト数) ..バイナリファイルからデータを読み込む
- fwrite(ファイルポインタリソース,書き込むデータ[,書き込むバイト数]) ..ファイルにデータを書き込む
- fclose(ファイルポインタリソース) ..ファイルを閉じる

- @ ..エラー制御演算子

- file_exists('ファイルのパス') ..ファイルが存在するかどうかを調べる
- filesize('ファイルのパス') ..ファイルのサイズ(バイト数)を調べる
- filemtime('ファイルのパス') ..ファイルが最後に更新された日時を表す
- fileatime('ファイルのパス') ..ファイルが最後にアクセスされた日時を表す
- is_readable('ファイルのパス') ..ファイルが存在し、かつ読み込み可能か調べる
- is_writable('ファイルのパス') ..ファイルが存在し、かつ書き込み可能か調べる

## ユーザー定義関数の基本

- function 関数名($引数1,$引数2,...,$引数n){関数の処理内容} ..ユーザー定義関数の定義
- 関数名($引数1,$引数2,...,$引数n) ..ユーザー定義関数の呼び出し

## ユーザー定義関数の作成例

```PHP
function the_content_first($count){
  $content=get_the_content();
  $content=strip_tags($content);
  $len=mb_strlen($content,'utf-8');
  $content=mb_substr($content,0,$count,'utf-8');
  if($len>$count){
    $count.='...';
  }
  echo $count;
}
```

## ユーザー定義関数のライブラリ化

- require('ファイル名') ..別のファイルの内容を取り込むことができる
- require_once('ファイル名') ..別のファイルの内容を1回だけ取り込む
  - require ..ファイルが見つからなかったらエラー
  - include ..ファイルが見つからなかったら警告
- function.php ..wordpress独自のユーザー定義関数ライブラリ

- テーマを超えてユーザー定義関数を使いたい -> プラグイン化
- プラグイン化の手順
  1. プラグイン用のディレクトリの作成(wp-content->plugins->)
  2. プラグインのPHPファイルを作成
  3. 定型コメントとユーザー定義関数を入れる
  4. wordpressの管理画面でプラグインを有効化

## コールバック関数

- コールバック関数とは、PHP本体やwordpressのコアから呼び出してもらい動作する関数
- コールバックを使うPHPの組み込み関数の主なもの
  - array_map
  - array_filter
  - array_udiff
  - array_uintersect
  - usort
  - uksort
  - preg_replace_callback

## 無名関数

- 他では使うことがない関数にまで関数名をつけるのは面倒 -> 無名関数

## ユーザー定義関数関係のトピック

- function($引数=デフォルト値) ..頻出する引数はデフォルト値として定義
- static 変数 = 初期値; ..静的変数
- 値渡しと参照渡し( function 関数名（&$変数)
- 変数のスコープ
  - global 変数1[,変数2...];
  - $GLOBALS['グローバル変数名']
- 無名関数とスコープ
  - function(...)use(変数名1,変数名2,...)
- JavaScriptとは無名関数の挙動が違うので注意！
- クロージャ ..状態を保存できる関数
